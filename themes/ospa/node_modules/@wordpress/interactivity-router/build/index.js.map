{"version":3,"names":["_interactivity","require","_head","_getConfig$navigation","directivePrefix","getRegionRootFragment","initialVdom","toVdom","render","parseInitialData","populateInitialData","batch","privateApis","navigationMode","getConfig","pages","Map","headElements","getPagePath","url","u","URL","window","location","pathname","search","fetchPage","html","res","fetch","status","text","dom","DOMParser","parseFromString","regionsToVdom","e","vdom","regions","head","process","env","IS_GUTENBERG_PLUGIN","fetchHeadAssets","body","get","document","attrName","querySelectorAll","forEach","region","id","getAttribute","has","title","querySelector","innerText","initialData","renderRegions","page","updateHead","fragment","forcePageReload","href","assign","Promise","addEventListener","pagePath","state","reload","map","call","script","set","tag","textContent","resolve","isValidLink","ref","HTMLAnchorElement","target","origin","startsWith","searchParams","isValidEvent","event","button","metaKey","ctrlKey","altKey","shiftKey","defaultPrevented","navigatingTo","actions","store","navigation","hasStarted","hasFinished","texts","navigate","options","clientNavigationDisabled","loadingAnimation","screenReaderAnnouncement","timeout","prefetch","timeoutPromise","setTimeout","loadingTimeout","message","loading","race","clearTimeout","config","history","replace","loaded","hash","scrollIntoView","force","exports","closest","preventDefault","nodeName"],"sources":["@wordpress/interactivity-router/src/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { store, privateApis, getConfig } from '@wordpress/interactivity';\n\n/**\n * Internal dependencies\n */\nimport { fetchHeadAssets, updateHead } from './head';\n\nconst {\n\tdirectivePrefix,\n\tgetRegionRootFragment,\n\tinitialVdom,\n\ttoVdom,\n\trender,\n\tparseInitialData,\n\tpopulateInitialData,\n\tbatch,\n} = privateApis(\n\t'I acknowledge that using private APIs means my theme or plugin will inevitably break in the next version of WordPress.'\n);\n\n// Check if the navigation mode is full page or region based.\nconst navigationMode =\n\tgetConfig( 'core/router' ).navigationMode ?? 'regionBased';\n\n// The cache of visited and prefetched pages, stylesheets and scripts.\nconst pages = new Map();\nconst headElements = new Map();\n\n// Helper to remove domain and hash from the URL. We are only interesting in\n// caching the path and the query.\nconst getPagePath = ( url ) => {\n\tconst u = new URL( url, window.location );\n\treturn u.pathname + u.search;\n};\n\n// Fetch a new page and convert it to a static virtual DOM.\nconst fetchPage = async ( url, { html } ) => {\n\ttry {\n\t\tif ( ! html ) {\n\t\t\tconst res = await window.fetch( url );\n\t\t\tif ( res.status !== 200 ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thtml = await res.text();\n\t\t}\n\t\tconst dom = new window.DOMParser().parseFromString( html, 'text/html' );\n\t\treturn regionsToVdom( dom );\n\t} catch ( e ) {\n\t\treturn false;\n\t}\n};\n\n// Return an object with VDOM trees of those HTML regions marked with a\n// `router-region` directive.\nconst regionsToVdom = async ( dom, { vdom } = {} ) => {\n\tconst regions = {};\n\tlet head;\n\tif ( process.env.IS_GUTENBERG_PLUGIN ) {\n\t\tif ( navigationMode === 'fullPage' ) {\n\t\t\thead = await fetchHeadAssets( dom, headElements );\n\t\t\tregions.body = vdom\n\t\t\t\t? vdom.get( document.body )\n\t\t\t\t: toVdom( dom.body );\n\t\t}\n\t}\n\tif ( navigationMode === 'regionBased' ) {\n\t\tconst attrName = `data-${ directivePrefix }-router-region`;\n\t\tdom.querySelectorAll( `[${ attrName }]` ).forEach( ( region ) => {\n\t\t\tconst id = region.getAttribute( attrName );\n\t\t\tregions[ id ] = vdom?.has( region )\n\t\t\t\t? vdom.get( region )\n\t\t\t\t: toVdom( region );\n\t\t} );\n\t}\n\tconst title = dom.querySelector( 'title' )?.innerText;\n\tconst initialData = parseInitialData( dom );\n\treturn { regions, head, title, initialData };\n};\n\n// Render all interactive regions contained in the given page.\nconst renderRegions = ( page ) => {\n\tbatch( () => {\n\t\tif ( process.env.IS_GUTENBERG_PLUGIN ) {\n\t\t\tif ( navigationMode === 'fullPage' ) {\n\t\t\t\t// Once this code is tested and more mature, the head should be updated for region based navigation as well.\n\t\t\t\tupdateHead( page.head );\n\t\t\t\tconst fragment = getRegionRootFragment( document.body );\n\t\t\t\trender( page.regions.body, fragment );\n\t\t\t}\n\t\t}\n\t\tif ( navigationMode === 'regionBased' ) {\n\t\t\tpopulateInitialData( page.initialData );\n\t\t\tconst attrName = `data-${ directivePrefix }-router-region`;\n\t\t\tdocument\n\t\t\t\t.querySelectorAll( `[${ attrName }]` )\n\t\t\t\t.forEach( ( region ) => {\n\t\t\t\t\tconst id = region.getAttribute( attrName );\n\t\t\t\t\tconst fragment = getRegionRootFragment( region );\n\t\t\t\t\trender( page.regions[ id ], fragment );\n\t\t\t\t} );\n\t\t}\n\t\tif ( page.title ) {\n\t\t\tdocument.title = page.title;\n\t\t}\n\t} );\n};\n\n/**\n * Load the given page forcing a full page reload.\n *\n * The function returns a promise that won't resolve, useful to prevent any\n * potential feedback indicating that the navigation has finished while the new\n * page is being loaded.\n *\n * @param {string} href The page href.\n * @return {Promise} Promise that never resolves.\n */\nconst forcePageReload = ( href ) => {\n\twindow.location.assign( href );\n\treturn new Promise( () => {} );\n};\n\n// Listen to the back and forward buttons and restore the page if it's in the\n// cache.\nwindow.addEventListener( 'popstate', async () => {\n\tconst pagePath = getPagePath( window.location ); // Remove hash.\n\tconst page = pages.has( pagePath ) && ( await pages.get( pagePath ) );\n\tif ( page ) {\n\t\trenderRegions( page );\n\t\t// Update the URL in the state.\n\t\tstate.url = window.location.href;\n\t} else {\n\t\twindow.location.reload();\n\t}\n} );\n\n// Initialize the router and cache the initial page using the initial vDOM.\n// Once this code is tested and more mature, the head should be updated for region based navigation as well.\nif ( process.env.IS_GUTENBERG_PLUGIN ) {\n\tif ( navigationMode === 'fullPage' ) {\n\t\t// Cache the scripts. Has to be called before fetching the assets.\n\t\t[].map.call( document.querySelectorAll( 'script[src]' ), ( script ) => {\n\t\t\theadElements.set( script.getAttribute( 'src' ), {\n\t\t\t\ttag: script,\n\t\t\t\ttext: script.textContent,\n\t\t\t} );\n\t\t} );\n\t\tawait fetchHeadAssets( document, headElements );\n\t}\n}\npages.set(\n\tgetPagePath( window.location ),\n\tPromise.resolve( regionsToVdom( document, { vdom: initialVdom } ) )\n);\n\n// Check if the link is valid for client-side navigation.\nconst isValidLink = ( ref ) =>\n\tref &&\n\tref instanceof window.HTMLAnchorElement &&\n\tref.href &&\n\t( ! ref.target || ref.target === '_self' ) &&\n\tref.origin === window.location.origin &&\n\t! ref.pathname.startsWith( '/wp-admin' ) &&\n\t! ref.pathname.startsWith( '/wp-login.php' ) &&\n\t! ref.getAttribute( 'href' ).startsWith( '#' ) &&\n\t! new URL( ref.href ).searchParams.has( '_wpnonce' );\n\n// Check if the event is valid for client-side navigation.\nconst isValidEvent = ( event ) =>\n\tevent &&\n\tevent.button === 0 && // Left clicks only.\n\t! event.metaKey && // Open in new tab (Mac).\n\t! event.ctrlKey && // Open in new tab (Windows).\n\t! event.altKey && // Download.\n\t! event.shiftKey &&\n\t! event.defaultPrevented;\n\n// Variable to store the current navigation.\nlet navigatingTo = '';\n\nexport const { state, actions } = store( 'core/router', {\n\tstate: {\n\t\turl: window.location.href,\n\t\tnavigation: {\n\t\t\thasStarted: false,\n\t\t\thasFinished: false,\n\t\t\ttexts: {},\n\t\t},\n\t},\n\tactions: {\n\t\t/**\n\t\t * Navigates to the specified page.\n\t\t *\n\t\t * This function normalizes the passed href, fetchs the page HTML if\n\t\t * needed, and updates any interactive regions whose contents have\n\t\t * changed. It also creates a new entry in the browser session history.\n\t\t *\n\t\t * @param {string}  href                               The page href.\n\t\t * @param {Object}  [options]                          Options object.\n\t\t * @param {boolean} [options.force]                    If true, it forces re-fetching the URL.\n\t\t * @param {string}  [options.html]                     HTML string to be used instead of fetching the requested URL.\n\t\t * @param {boolean} [options.replace]                  If true, it replaces the current entry in the browser session history.\n\t\t * @param {number}  [options.timeout]                  Time until the navigation is aborted, in milliseconds. Default is 10000.\n\t\t * @param {boolean} [options.loadingAnimation]         Whether an animation should be shown while navigating. Default to `true`.\n\t\t * @param {boolean} [options.screenReaderAnnouncement] Whether a message for screen readers should be announced while navigating. Default to `true`.\n\t\t *\n\t\t * @return {Promise} Promise that resolves once the navigation is completed or aborted.\n\t\t */\n\t\t*navigate( href, options = {} ) {\n\t\t\tconst { clientNavigationDisabled } = getConfig();\n\t\t\tif ( clientNavigationDisabled ) {\n\t\t\t\tyield forcePageReload( href );\n\t\t\t}\n\n\t\t\tconst pagePath = getPagePath( href );\n\t\t\tconst { navigation } = state;\n\t\t\tconst {\n\t\t\t\tloadingAnimation = true,\n\t\t\t\tscreenReaderAnnouncement = true,\n\t\t\t\ttimeout = 10000,\n\t\t\t} = options;\n\n\t\t\tnavigatingTo = href;\n\t\t\tactions.prefetch( pagePath, options );\n\n\t\t\t// Create a promise that resolves when the specified timeout ends.\n\t\t\t// The timeout value is 10 seconds by default.\n\t\t\tconst timeoutPromise = new Promise( ( resolve ) =>\n\t\t\t\tsetTimeout( resolve, timeout )\n\t\t\t);\n\n\t\t\t// Don't update the navigation status immediately, wait 400 ms.\n\t\t\tconst loadingTimeout = setTimeout( () => {\n\t\t\t\tif ( navigatingTo !== href ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( loadingAnimation ) {\n\t\t\t\t\tnavigation.hasStarted = true;\n\t\t\t\t\tnavigation.hasFinished = false;\n\t\t\t\t}\n\t\t\t\tif ( screenReaderAnnouncement ) {\n\t\t\t\t\tnavigation.message = navigation.texts.loading;\n\t\t\t\t}\n\t\t\t}, 400 );\n\n\t\t\tconst page = yield Promise.race( [\n\t\t\t\tpages.get( pagePath ),\n\t\t\t\ttimeoutPromise,\n\t\t\t] );\n\n\t\t\t// Dismiss loading message if it hasn't been added yet.\n\t\t\tclearTimeout( loadingTimeout );\n\n\t\t\t// Once the page is fetched, the destination URL could have changed\n\t\t\t// (e.g., by clicking another link in the meantime). If so, bail\n\t\t\t// out, and let the newer execution to update the HTML.\n\t\t\tif ( navigatingTo !== href ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tpage &&\n\t\t\t\t! page.initialData?.config?.[ 'core/router' ]\n\t\t\t\t\t?.clientNavigationDisabled\n\t\t\t) {\n\t\t\t\tyield renderRegions( page );\n\t\t\t\twindow.history[\n\t\t\t\t\toptions.replace ? 'replaceState' : 'pushState'\n\t\t\t\t]( {}, '', href );\n\n\t\t\t\t// Update the URL in the state.\n\t\t\t\tstate.url = href;\n\n\t\t\t\t// Update the navigation status once the the new page rendering\n\t\t\t\t// has been completed.\n\t\t\t\tif ( loadingAnimation ) {\n\t\t\t\t\tnavigation.hasStarted = false;\n\t\t\t\t\tnavigation.hasFinished = true;\n\t\t\t\t}\n\n\t\t\t\tif ( screenReaderAnnouncement ) {\n\t\t\t\t\t// Announce that the page has been loaded. If the message is the\n\t\t\t\t\t// same, we use a no-break space similar to the @wordpress/a11y\n\t\t\t\t\t// package: https://github.com/WordPress/gutenberg/blob/c395242b8e6ee20f8b06c199e4fc2920d7018af1/packages/a11y/src/filter-message.js#L20-L26\n\t\t\t\t\tnavigation.message =\n\t\t\t\t\t\tnavigation.texts.loaded +\n\t\t\t\t\t\t( navigation.message === navigation.texts.loaded\n\t\t\t\t\t\t\t? '\\u00A0'\n\t\t\t\t\t\t\t: '' );\n\t\t\t\t}\n\n\t\t\t\t// Scroll to the anchor if exits in the link.\n\t\t\t\tconst { hash } = new URL( href, window.location );\n\t\t\t\tif ( hash ) {\n\t\t\t\t\tdocument.querySelector( hash )?.scrollIntoView();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tyield forcePageReload( href );\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Prefetchs the page with the passed URL.\n\t\t *\n\t\t * The function normalizes the URL and stores internally the fetch\n\t\t * promise, to avoid triggering a second fetch for an ongoing request.\n\t\t *\n\t\t * @param {string}  url             The page URL.\n\t\t * @param {Object}  [options]       Options object.\n\t\t * @param {boolean} [options.force] Force fetching the URL again.\n\t\t * @param {string}  [options.html]  HTML string to be used instead of fetching the requested URL.\n\t\t */\n\t\tprefetch( url, options = {} ) {\n\t\t\tconst { clientNavigationDisabled } = getConfig();\n\t\t\tif ( clientNavigationDisabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst pagePath = getPagePath( url );\n\t\t\tif ( options.force || ! pages.has( pagePath ) ) {\n\t\t\t\tpages.set( pagePath, fetchPage( pagePath, options ) );\n\t\t\t}\n\t\t},\n\t},\n} );\n\n// Add click and prefetch to all links.\nif ( process.env.IS_GUTENBERG_PLUGIN ) {\n\tif ( navigationMode === 'fullPage' ) {\n\t\t// Navigate on click.\n\t\tdocument.addEventListener(\n\t\t\t'click',\n\t\t\tfunction ( event ) {\n\t\t\t\tconst ref = event.target.closest( 'a' );\n\t\t\t\tif ( isValidLink( ref ) && isValidEvent( event ) ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.navigate( ref.href );\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\t// Prefetch on hover.\n\t\tdocument.addEventListener(\n\t\t\t'mouseenter',\n\t\t\tfunction ( event ) {\n\t\t\t\tif ( event.target?.nodeName === 'A' ) {\n\t\t\t\t\tconst ref = event.target.closest( 'a' );\n\t\t\t\t\tif ( isValidLink( ref ) && isValidEvent( event ) ) {\n\t\t\t\t\t\tactions.prefetch( ref.href );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t}\n}\n"],"mappings":";;;;;;AAGA,IAAAA,cAAA,GAAAC,OAAA;AAKA,IAAAC,KAAA,GAAAD,OAAA;AAAqD,IAAAE,qBAAA;AARrD;AACA;AACA;AAGA;AACA;AACA;AAGA,MAAM;EACLC,eAAe;EACfC,qBAAqB;EACrBC,WAAW;EACXC,MAAM;EACNC,MAAM;EACNC,gBAAgB;EAChBC,mBAAmB;EACnBC;AACD,CAAC,GAAG,IAAAC,0BAAW,EACd,wHACD,CAAC;;AAED;AACA,MAAMC,cAAc,IAAAV,qBAAA,GACnB,IAAAW,wBAAS,EAAE,aAAc,CAAC,CAACD,cAAc,cAAAV,qBAAA,cAAAA,qBAAA,GAAI,aAAa;;AAE3D;AACA,MAAMY,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC;AACvB,MAAMC,YAAY,GAAG,IAAID,GAAG,CAAC,CAAC;;AAE9B;AACA;AACA,MAAME,WAAW,GAAKC,GAAG,IAAM;EAC9B,MAAMC,CAAC,GAAG,IAAIC,GAAG,CAAEF,GAAG,EAAEG,MAAM,CAACC,QAAS,CAAC;EACzC,OAAOH,CAAC,CAACI,QAAQ,GAAGJ,CAAC,CAACK,MAAM;AAC7B,CAAC;;AAED;AACA,MAAMC,SAAS,GAAG,MAAAA,CAAQP,GAAG,EAAE;EAAEQ;AAAK,CAAC,KAAM;EAC5C,IAAI;IACH,IAAK,CAAEA,IAAI,EAAG;MACb,MAAMC,GAAG,GAAG,MAAMN,MAAM,CAACO,KAAK,CAAEV,GAAI,CAAC;MACrC,IAAKS,GAAG,CAACE,MAAM,KAAK,GAAG,EAAG;QACzB,OAAO,KAAK;MACb;MACAH,IAAI,GAAG,MAAMC,GAAG,CAACG,IAAI,CAAC,CAAC;IACxB;IACA,MAAMC,GAAG,GAAG,IAAIV,MAAM,CAACW,SAAS,CAAC,CAAC,CAACC,eAAe,CAAEP,IAAI,EAAE,WAAY,CAAC;IACvE,OAAOQ,aAAa,CAAEH,GAAI,CAAC;EAC5B,CAAC,CAAC,OAAQI,CAAC,EAAG;IACb,OAAO,KAAK;EACb;AACD,CAAC;;AAED;AACA;AACA,MAAMD,aAAa,GAAG,MAAAA,CAAQH,GAAG,EAAE;EAAEK;AAAK,CAAC,GAAG,CAAC,CAAC,KAAM;EACrD,MAAMC,OAAO,GAAG,CAAC,CAAC;EAClB,IAAIC,IAAI;EACR,IAAKC,OAAO,CAACC,GAAG,CAACC,mBAAmB,EAAG;IACtC,IAAK7B,cAAc,KAAK,UAAU,EAAG;MACpC0B,IAAI,GAAG,MAAM,IAAAI,qBAAe,EAAEX,GAAG,EAAEf,YAAa,CAAC;MACjDqB,OAAO,CAACM,IAAI,GAAGP,IAAI,GAChBA,IAAI,CAACQ,GAAG,CAAEC,QAAQ,CAACF,IAAK,CAAC,GACzBrC,MAAM,CAAEyB,GAAG,CAACY,IAAK,CAAC;IACtB;EACD;EACA,IAAK/B,cAAc,KAAK,aAAa,EAAG;IACvC,MAAMkC,QAAQ,GAAI,QAAQ3C,eAAiB,gBAAe;IAC1D4B,GAAG,CAACgB,gBAAgB,CAAG,IAAID,QAAU,GAAG,CAAC,CAACE,OAAO,CAAIC,MAAM,IAAM;MAChE,MAAMC,EAAE,GAAGD,MAAM,CAACE,YAAY,CAAEL,QAAS,CAAC;MAC1CT,OAAO,CAAEa,EAAE,CAAE,GAAGd,IAAI,EAAEgB,GAAG,CAAEH,MAAO,CAAC,GAChCb,IAAI,CAACQ,GAAG,CAAEK,MAAO,CAAC,GAClB3C,MAAM,CAAE2C,MAAO,CAAC;IACpB,CAAE,CAAC;EACJ;EACA,MAAMI,KAAK,GAAGtB,GAAG,CAACuB,aAAa,CAAE,OAAQ,CAAC,EAAEC,SAAS;EACrD,MAAMC,WAAW,GAAGhD,gBAAgB,CAAEuB,GAAI,CAAC;EAC3C,OAAO;IAAEM,OAAO;IAAEC,IAAI;IAAEe,KAAK;IAAEG;EAAY,CAAC;AAC7C,CAAC;;AAED;AACA,MAAMC,aAAa,GAAKC,IAAI,IAAM;EACjChD,KAAK,CAAE,MAAM;IACZ,IAAK6B,OAAO,CAACC,GAAG,CAACC,mBAAmB,EAAG;MACtC,IAAK7B,cAAc,KAAK,UAAU,EAAG;QACpC;QACA,IAAA+C,gBAAU,EAAED,IAAI,CAACpB,IAAK,CAAC;QACvB,MAAMsB,QAAQ,GAAGxD,qBAAqB,CAAEyC,QAAQ,CAACF,IAAK,CAAC;QACvDpC,MAAM,CAAEmD,IAAI,CAACrB,OAAO,CAACM,IAAI,EAAEiB,QAAS,CAAC;MACtC;IACD;IACA,IAAKhD,cAAc,KAAK,aAAa,EAAG;MACvCH,mBAAmB,CAAEiD,IAAI,CAACF,WAAY,CAAC;MACvC,MAAMV,QAAQ,GAAI,QAAQ3C,eAAiB,gBAAe;MAC1D0C,QAAQ,CACNE,gBAAgB,CAAG,IAAID,QAAU,GAAG,CAAC,CACrCE,OAAO,CAAIC,MAAM,IAAM;QACvB,MAAMC,EAAE,GAAGD,MAAM,CAACE,YAAY,CAAEL,QAAS,CAAC;QAC1C,MAAMc,QAAQ,GAAGxD,qBAAqB,CAAE6C,MAAO,CAAC;QAChD1C,MAAM,CAAEmD,IAAI,CAACrB,OAAO,CAAEa,EAAE,CAAE,EAAEU,QAAS,CAAC;MACvC,CAAE,CAAC;IACL;IACA,IAAKF,IAAI,CAACL,KAAK,EAAG;MACjBR,QAAQ,CAACQ,KAAK,GAAGK,IAAI,CAACL,KAAK;IAC5B;EACD,CAAE,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMQ,eAAe,GAAKC,IAAI,IAAM;EACnCzC,MAAM,CAACC,QAAQ,CAACyC,MAAM,CAAED,IAAK,CAAC;EAC9B,OAAO,IAAIE,OAAO,CAAE,MAAM,CAAC,CAAE,CAAC;AAC/B,CAAC;;AAED;AACA;AACA3C,MAAM,CAAC4C,gBAAgB,CAAE,UAAU,EAAE,YAAY;EAChD,MAAMC,QAAQ,GAAGjD,WAAW,CAAEI,MAAM,CAACC,QAAS,CAAC,CAAC,CAAC;EACjD,MAAMoC,IAAI,GAAG5C,KAAK,CAACsC,GAAG,CAAEc,QAAS,CAAC,KAAM,MAAMpD,KAAK,CAAC8B,GAAG,CAAEsB,QAAS,CAAC,CAAE;EACrE,IAAKR,IAAI,EAAG;IACXD,aAAa,CAAEC,IAAK,CAAC;IACrB;IACAS,KAAK,CAACjD,GAAG,GAAGG,MAAM,CAACC,QAAQ,CAACwC,IAAI;EACjC,CAAC,MAAM;IACNzC,MAAM,CAACC,QAAQ,CAAC8C,MAAM,CAAC,CAAC;EACzB;AACD,CAAE,CAAC;;AAEH;AACA;AACA,IAAK7B,OAAO,CAACC,GAAG,CAACC,mBAAmB,EAAG;EACtC,IAAK7B,cAAc,KAAK,UAAU,EAAG;IACpC;IACA,EAAE,CAACyD,GAAG,CAACC,IAAI,CAAEzB,QAAQ,CAACE,gBAAgB,CAAE,aAAc,CAAC,EAAIwB,MAAM,IAAM;MACtEvD,YAAY,CAACwD,GAAG,CAAED,MAAM,CAACpB,YAAY,CAAE,KAAM,CAAC,EAAE;QAC/CsB,GAAG,EAAEF,MAAM;QACXzC,IAAI,EAAEyC,MAAM,CAACG;MACd,CAAE,CAAC;IACJ,CAAE,CAAC;IACH,MAAM,IAAAhC,qBAAe,EAAEG,QAAQ,EAAE7B,YAAa,CAAC;EAChD;AACD;AACAF,KAAK,CAAC0D,GAAG,CACRvD,WAAW,CAAEI,MAAM,CAACC,QAAS,CAAC,EAC9B0C,OAAO,CAACW,OAAO,CAAEzC,aAAa,CAAEW,QAAQ,EAAE;EAAET,IAAI,EAAE/B;AAAY,CAAE,CAAE,CACnE,CAAC;;AAED;AACA,MAAMuE,WAAW,GAAKC,GAAG,IACxBA,GAAG,IACHA,GAAG,YAAYxD,MAAM,CAACyD,iBAAiB,IACvCD,GAAG,CAACf,IAAI,KACN,CAAEe,GAAG,CAACE,MAAM,IAAIF,GAAG,CAACE,MAAM,KAAK,OAAO,CAAE,IAC1CF,GAAG,CAACG,MAAM,KAAK3D,MAAM,CAACC,QAAQ,CAAC0D,MAAM,IACrC,CAAEH,GAAG,CAACtD,QAAQ,CAAC0D,UAAU,CAAE,WAAY,CAAC,IACxC,CAAEJ,GAAG,CAACtD,QAAQ,CAAC0D,UAAU,CAAE,eAAgB,CAAC,IAC5C,CAAEJ,GAAG,CAAC1B,YAAY,CAAE,MAAO,CAAC,CAAC8B,UAAU,CAAE,GAAI,CAAC,IAC9C,CAAE,IAAI7D,GAAG,CAAEyD,GAAG,CAACf,IAAK,CAAC,CAACoB,YAAY,CAAC9B,GAAG,CAAE,UAAW,CAAC;;AAErD;AACA,MAAM+B,YAAY,GAAKC,KAAK,IAC3BA,KAAK,IACLA,KAAK,CAACC,MAAM,KAAK,CAAC;AAAI;AACtB,CAAED,KAAK,CAACE,OAAO;AAAI;AACnB,CAAEF,KAAK,CAACG,OAAO;AAAI;AACnB,CAAEH,KAAK,CAACI,MAAM;AAAI;AAClB,CAAEJ,KAAK,CAACK,QAAQ,IAChB,CAAEL,KAAK,CAACM,gBAAgB;;AAEzB;AACA,IAAIC,YAAY,GAAG,EAAE;AAEd,MAAM;EAAExB,KAAK;EAAEyB;AAAQ,CAAC,GAAG,IAAAC,oBAAK,EAAE,aAAa,EAAE;EACvD1B,KAAK,EAAE;IACNjD,GAAG,EAAEG,MAAM,CAACC,QAAQ,CAACwC,IAAI;IACzBgC,UAAU,EAAE;MACXC,UAAU,EAAE,KAAK;MACjBC,WAAW,EAAE,KAAK;MAClBC,KAAK,EAAE,CAAC;IACT;EACD,CAAC;EACDL,OAAO,EAAE;IACR;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACE,CAACM,QAAQA,CAAEpC,IAAI,EAAEqC,OAAO,GAAG,CAAC,CAAC,EAAG;MAC/B,MAAM;QAAEC;MAAyB,CAAC,GAAG,IAAAvF,wBAAS,EAAC,CAAC;MAChD,IAAKuF,wBAAwB,EAAG;QAC/B,MAAMvC,eAAe,CAAEC,IAAK,CAAC;MAC9B;MAEA,MAAMI,QAAQ,GAAGjD,WAAW,CAAE6C,IAAK,CAAC;MACpC,MAAM;QAAEgC;MAAW,CAAC,GAAG3B,KAAK;MAC5B,MAAM;QACLkC,gBAAgB,GAAG,IAAI;QACvBC,wBAAwB,GAAG,IAAI;QAC/BC,OAAO,GAAG;MACX,CAAC,GAAGJ,OAAO;MAEXR,YAAY,GAAG7B,IAAI;MACnB8B,OAAO,CAACY,QAAQ,CAAEtC,QAAQ,EAAEiC,OAAQ,CAAC;;MAErC;MACA;MACA,MAAMM,cAAc,GAAG,IAAIzC,OAAO,CAAIW,OAAO,IAC5C+B,UAAU,CAAE/B,OAAO,EAAE4B,OAAQ,CAC9B,CAAC;;MAED;MACA,MAAMI,cAAc,GAAGD,UAAU,CAAE,MAAM;QACxC,IAAKf,YAAY,KAAK7B,IAAI,EAAG;UAC5B;QACD;QAEA,IAAKuC,gBAAgB,EAAG;UACvBP,UAAU,CAACC,UAAU,GAAG,IAAI;UAC5BD,UAAU,CAACE,WAAW,GAAG,KAAK;QAC/B;QACA,IAAKM,wBAAwB,EAAG;UAC/BR,UAAU,CAACc,OAAO,GAAGd,UAAU,CAACG,KAAK,CAACY,OAAO;QAC9C;MACD,CAAC,EAAE,GAAI,CAAC;MAER,MAAMnD,IAAI,GAAG,MAAMM,OAAO,CAAC8C,IAAI,CAAE,CAChChG,KAAK,CAAC8B,GAAG,CAAEsB,QAAS,CAAC,EACrBuC,cAAc,CACb,CAAC;;MAEH;MACAM,YAAY,CAAEJ,cAAe,CAAC;;MAE9B;MACA;MACA;MACA,IAAKhB,YAAY,KAAK7B,IAAI,EAAG;QAC5B;MACD;MAEA,IACCJ,IAAI,IACJ,CAAEA,IAAI,CAACF,WAAW,EAAEwD,MAAM,GAAI,aAAa,CAAE,EAC1CZ,wBAAwB,EAC1B;QACD,MAAM3C,aAAa,CAAEC,IAAK,CAAC;QAC3BrC,MAAM,CAAC4F,OAAO,CACbd,OAAO,CAACe,OAAO,GAAG,cAAc,GAAG,WAAW,CAC9C,CAAE,CAAC,CAAC,EAAE,EAAE,EAAEpD,IAAK,CAAC;;QAEjB;QACAK,KAAK,CAACjD,GAAG,GAAG4C,IAAI;;QAEhB;QACA;QACA,IAAKuC,gBAAgB,EAAG;UACvBP,UAAU,CAACC,UAAU,GAAG,KAAK;UAC7BD,UAAU,CAACE,WAAW,GAAG,IAAI;QAC9B;QAEA,IAAKM,wBAAwB,EAAG;UAC/B;UACA;UACA;UACAR,UAAU,CAACc,OAAO,GACjBd,UAAU,CAACG,KAAK,CAACkB,MAAM,IACrBrB,UAAU,CAACc,OAAO,KAAKd,UAAU,CAACG,KAAK,CAACkB,MAAM,GAC7C,QAAQ,GACR,EAAE,CAAE;QACT;;QAEA;QACA,MAAM;UAAEC;QAAK,CAAC,GAAG,IAAIhG,GAAG,CAAE0C,IAAI,EAAEzC,MAAM,CAACC,QAAS,CAAC;QACjD,IAAK8F,IAAI,EAAG;UACXvE,QAAQ,CAACS,aAAa,CAAE8D,IAAK,CAAC,EAAEC,cAAc,CAAC,CAAC;QACjD;MACD,CAAC,MAAM;QACN,MAAMxD,eAAe,CAAEC,IAAK,CAAC;MAC9B;IACD,CAAC;IAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACE0C,QAAQA,CAAEtF,GAAG,EAAEiF,OAAO,GAAG,CAAC,CAAC,EAAG;MAC7B,MAAM;QAAEC;MAAyB,CAAC,GAAG,IAAAvF,wBAAS,EAAC,CAAC;MAChD,IAAKuF,wBAAwB,EAAG;QAC/B;MACD;MAEA,MAAMlC,QAAQ,GAAGjD,WAAW,CAAEC,GAAI,CAAC;MACnC,IAAKiF,OAAO,CAACmB,KAAK,IAAI,CAAExG,KAAK,CAACsC,GAAG,CAAEc,QAAS,CAAC,EAAG;QAC/CpD,KAAK,CAAC0D,GAAG,CAAEN,QAAQ,EAAEzC,SAAS,CAAEyC,QAAQ,EAAEiC,OAAQ,CAAE,CAAC;MACtD;IACD;EACD;AACD,CAAE,CAAC;;AAEH;AAAAoB,OAAA,CAAA3B,OAAA,GAAAA,OAAA;AAAA2B,OAAA,CAAApD,KAAA,GAAAA,KAAA;AACA,IAAK5B,OAAO,CAACC,GAAG,CAACC,mBAAmB,EAAG;EACtC,IAAK7B,cAAc,KAAK,UAAU,EAAG;IACpC;IACAiC,QAAQ,CAACoB,gBAAgB,CACxB,OAAO,EACP,UAAWmB,KAAK,EAAG;MAClB,MAAMP,GAAG,GAAGO,KAAK,CAACL,MAAM,CAACyC,OAAO,CAAE,GAAI,CAAC;MACvC,IAAK5C,WAAW,CAAEC,GAAI,CAAC,IAAIM,YAAY,CAAEC,KAAM,CAAC,EAAG;QAClDA,KAAK,CAACqC,cAAc,CAAC,CAAC;QACtB7B,OAAO,CAACM,QAAQ,CAAErB,GAAG,CAACf,IAAK,CAAC;MAC7B;IACD,CAAC,EACD,IACD,CAAC;IACD;IACAjB,QAAQ,CAACoB,gBAAgB,CACxB,YAAY,EACZ,UAAWmB,KAAK,EAAG;MAClB,IAAKA,KAAK,CAACL,MAAM,EAAE2C,QAAQ,KAAK,GAAG,EAAG;QACrC,MAAM7C,GAAG,GAAGO,KAAK,CAACL,MAAM,CAACyC,OAAO,CAAE,GAAI,CAAC;QACvC,IAAK5C,WAAW,CAAEC,GAAI,CAAC,IAAIM,YAAY,CAAEC,KAAM,CAAC,EAAG;UAClDQ,OAAO,CAACY,QAAQ,CAAE3B,GAAG,CAACf,IAAK,CAAC;QAC7B;MACD;IACD,CAAC,EACD,IACD,CAAC;EACF;AACD","ignoreList":[]}