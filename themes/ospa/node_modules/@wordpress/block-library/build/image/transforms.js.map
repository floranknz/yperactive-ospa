{"version":3,"names":["_blob","require","_blocks","_data","_notices","_i18n","stripFirstImage","attributes","shortcode","body","document","implementation","createHTMLDocument","innerHTML","content","nodeToRemove","querySelector","parentNode","removeChild","trim","getFirstAnchorAttributeFormHTML","html","attributeName","firstElementChild","nodeName","getAttribute","undefined","imageSchema","img","classes","schema","phrasingContentSchema","figure","children","a","figcaption","transforms","from","type","isMatch","node","transform","className","alignMatches","exec","anchor","id","align","idMatches","Number","anchorElement","linkDestination","href","rel","linkClass","getBlockAttributes","outerHTML","createBlock","files","some","file","indexOf","createErrorNotice","dispatch","noticesStore","__","every","blocks","map","url","createBlobURL","tag","source","attribute","selector","alt","caption","named","parseInt","replace","_default","exports","default"],"sources":["@wordpress/block-library/src/image/transforms.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { createBlobURL } from '@wordpress/blob';\nimport { createBlock, getBlockAttributes } from '@wordpress/blocks';\nimport { dispatch } from '@wordpress/data';\nimport { store as noticesStore } from '@wordpress/notices';\nimport { __ } from '@wordpress/i18n';\n\nexport function stripFirstImage( attributes, { shortcode } ) {\n\tconst { body } = document.implementation.createHTMLDocument( '' );\n\n\tbody.innerHTML = shortcode.content;\n\n\tlet nodeToRemove = body.querySelector( 'img' );\n\n\t// If an image has parents, find the topmost node to remove.\n\twhile (\n\t\tnodeToRemove &&\n\t\tnodeToRemove.parentNode &&\n\t\tnodeToRemove.parentNode !== body\n\t) {\n\t\tnodeToRemove = nodeToRemove.parentNode;\n\t}\n\n\tif ( nodeToRemove ) {\n\t\tnodeToRemove.parentNode.removeChild( nodeToRemove );\n\t}\n\n\treturn body.innerHTML.trim();\n}\n\nfunction getFirstAnchorAttributeFormHTML( html, attributeName ) {\n\tconst { body } = document.implementation.createHTMLDocument( '' );\n\n\tbody.innerHTML = html;\n\n\tconst { firstElementChild } = body;\n\n\tif ( firstElementChild && firstElementChild.nodeName === 'A' ) {\n\t\treturn firstElementChild.getAttribute( attributeName ) || undefined;\n\t}\n}\n\nconst imageSchema = {\n\timg: {\n\t\tattributes: [ 'src', 'alt', 'title' ],\n\t\tclasses: [\n\t\t\t'alignleft',\n\t\t\t'aligncenter',\n\t\t\t'alignright',\n\t\t\t'alignnone',\n\t\t\t/^wp-image-\\d+$/,\n\t\t],\n\t},\n};\n\nconst schema = ( { phrasingContentSchema } ) => ( {\n\tfigure: {\n\t\trequire: [ 'img' ],\n\t\tchildren: {\n\t\t\t...imageSchema,\n\t\t\ta: {\n\t\t\t\tattributes: [ 'href', 'rel', 'target' ],\n\t\t\t\tchildren: imageSchema,\n\t\t\t},\n\t\t\tfigcaption: {\n\t\t\t\tchildren: phrasingContentSchema,\n\t\t\t},\n\t\t},\n\t},\n} );\n\nconst transforms = {\n\tfrom: [\n\t\t{\n\t\t\ttype: 'raw',\n\t\t\tisMatch: ( node ) =>\n\t\t\t\tnode.nodeName === 'FIGURE' && !! node.querySelector( 'img' ),\n\t\t\tschema,\n\t\t\ttransform: ( node ) => {\n\t\t\t\t// Search both figure and image classes. Alignment could be\n\t\t\t\t// set on either. ID is set on the image.\n\t\t\t\tconst className =\n\t\t\t\t\tnode.className +\n\t\t\t\t\t' ' +\n\t\t\t\t\tnode.querySelector( 'img' ).className;\n\t\t\t\tconst alignMatches =\n\t\t\t\t\t/(?:^|\\s)align(left|center|right)(?:$|\\s)/.exec(\n\t\t\t\t\t\tclassName\n\t\t\t\t\t);\n\t\t\t\tconst anchor = node.id === '' ? undefined : node.id;\n\t\t\t\tconst align = alignMatches ? alignMatches[ 1 ] : undefined;\n\t\t\t\tconst idMatches = /(?:^|\\s)wp-image-(\\d+)(?:$|\\s)/.exec(\n\t\t\t\t\tclassName\n\t\t\t\t);\n\t\t\t\tconst id = idMatches ? Number( idMatches[ 1 ] ) : undefined;\n\t\t\t\tconst anchorElement = node.querySelector( 'a' );\n\t\t\t\tconst linkDestination =\n\t\t\t\t\tanchorElement && anchorElement.href ? 'custom' : undefined;\n\t\t\t\tconst href =\n\t\t\t\t\tanchorElement && anchorElement.href\n\t\t\t\t\t\t? anchorElement.href\n\t\t\t\t\t\t: undefined;\n\t\t\t\tconst rel =\n\t\t\t\t\tanchorElement && anchorElement.rel\n\t\t\t\t\t\t? anchorElement.rel\n\t\t\t\t\t\t: undefined;\n\t\t\t\tconst linkClass =\n\t\t\t\t\tanchorElement && anchorElement.className\n\t\t\t\t\t\t? anchorElement.className\n\t\t\t\t\t\t: undefined;\n\t\t\t\tconst attributes = getBlockAttributes(\n\t\t\t\t\t'core/image',\n\t\t\t\t\tnode.outerHTML,\n\t\t\t\t\t{\n\t\t\t\t\t\talign,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tlinkDestination,\n\t\t\t\t\t\thref,\n\t\t\t\t\t\trel,\n\t\t\t\t\t\tlinkClass,\n\t\t\t\t\t\tanchor,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn createBlock( 'core/image', attributes );\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\t// Note: when dragging and dropping multiple files onto a gallery this overrides the\n\t\t\t// gallery transform in order to add new images to the gallery instead of\n\t\t\t// creating a new gallery.\n\t\t\ttype: 'files',\n\t\t\tisMatch( files ) {\n\t\t\t\t// The following check is intended to catch non-image files when dropped together with images.\n\t\t\t\tif (\n\t\t\t\t\tfiles.some(\n\t\t\t\t\t\t( file ) => file.type.indexOf( 'image/' ) === 0\n\t\t\t\t\t) &&\n\t\t\t\t\tfiles.some(\n\t\t\t\t\t\t( file ) => file.type.indexOf( 'image/' ) !== 0\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tconst { createErrorNotice } = dispatch( noticesStore );\n\t\t\t\t\tcreateErrorNotice(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'If uploading to a gallery all files need to be image formats'\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'gallery-transform-invalid-file',\n\t\t\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn files.every(\n\t\t\t\t\t( file ) => file.type.indexOf( 'image/' ) === 0\n\t\t\t\t);\n\t\t\t},\n\t\t\ttransform( files ) {\n\t\t\t\tconst blocks = files.map( ( file ) => {\n\t\t\t\t\treturn createBlock( 'core/image', {\n\t\t\t\t\t\turl: createBlobURL( file ),\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t\treturn blocks;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttype: 'shortcode',\n\t\t\ttag: 'caption',\n\t\t\tattributes: {\n\t\t\t\turl: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tsource: 'attribute',\n\t\t\t\t\tattribute: 'src',\n\t\t\t\t\tselector: 'img',\n\t\t\t\t},\n\t\t\t\talt: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tsource: 'attribute',\n\t\t\t\t\tattribute: 'alt',\n\t\t\t\t\tselector: 'img',\n\t\t\t\t},\n\t\t\t\tcaption: {\n\t\t\t\t\tshortcode: stripFirstImage,\n\t\t\t\t},\n\t\t\t\thref: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\n\t\t\t\t\t\t\tshortcode.content,\n\t\t\t\t\t\t\t'href'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\trel: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\n\t\t\t\t\t\t\tshortcode.content,\n\t\t\t\t\t\t\t'rel'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tlinkClass: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\n\t\t\t\t\t\t\tshortcode.content,\n\t\t\t\t\t\t\t'class'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tid: {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tshortcode: ( { named: { id } } ) => {\n\t\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn parseInt( id.replace( 'attachment_', '' ), 10 );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\talign: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tshortcode: ( { named: { align = 'alignnone' } } ) => {\n\t\t\t\t\t\treturn align.replace( 'align', '' );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t],\n};\n\nexport default transforms;\n"],"mappings":"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","ignoreList":[]}