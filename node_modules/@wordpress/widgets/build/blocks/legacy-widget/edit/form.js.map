{"version":3,"names":["_clsx","_interopRequireDefault","require","_element","_data","_notices","_i18n","_components","_compose","_control","Form","title","isVisible","id","idBase","instance","isWide","onChangeInstance","onChangeHasPreview","ref","useRef","isMediumLargeViewport","useViewportMatch","outgoingInstances","Set","incomingInstances","createNotice","useDispatch","noticesStore","useEffect","current","has","delete","control","Control","nextInstance","add","onError","error","window","console","sprintf","__","appendChild","element","destroy","_react","createElement","className","clsx","Popover","focusOnMount","placement","offset","resize","flip","shift","hidden"],"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/form.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport clsx from 'clsx';\n/**\n * WordPress dependencies\n */\nimport { useRef, useEffect } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\nimport { store as noticesStore } from '@wordpress/notices';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Popover } from '@wordpress/components';\nimport { useViewportMatch } from '@wordpress/compose';\n/**\n * Internal dependencies\n */\nimport Control from './control';\n\nexport default function Form( {\n\ttitle,\n\tisVisible,\n\tid,\n\tidBase,\n\tinstance,\n\tisWide,\n\tonChangeInstance,\n\tonChangeHasPreview,\n} ) {\n\tconst ref = useRef();\n\n\tconst isMediumLargeViewport = useViewportMatch( 'small' );\n\n\t// We only want to remount the control when the instance changes\n\t// *externally*. For example, if the user performs an undo. To do this, we\n\t// keep track of changes made to instance by the control itself and then\n\t// ignore those.\n\tconst outgoingInstances = useRef( new Set() );\n\tconst incomingInstances = useRef( new Set() );\n\n\tconst { createNotice } = useDispatch( noticesStore );\n\n\tuseEffect( () => {\n\t\tif ( incomingInstances.current.has( instance ) ) {\n\t\t\tincomingInstances.current.delete( instance );\n\t\t\treturn;\n\t\t}\n\n\t\tconst control = new Control( {\n\t\t\tid,\n\t\t\tidBase,\n\t\t\tinstance,\n\t\t\tonChangeInstance( nextInstance ) {\n\t\t\t\toutgoingInstances.current.add( instance );\n\t\t\t\tincomingInstances.current.add( nextInstance );\n\t\t\t\tonChangeInstance( nextInstance );\n\t\t\t},\n\t\t\tonChangeHasPreview,\n\t\t\tonError( error ) {\n\t\t\t\twindow.console.error( error );\n\t\t\t\tcreateNotice(\n\t\t\t\t\t'error',\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: %s: the name of the affected block. */\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'The \"%s\" block was affected by errors and may not function properly. Check the developer tools for more details.'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tidBase || id\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t},\n\t\t} );\n\n\t\tref.current.appendChild( control.element );\n\n\t\treturn () => {\n\t\t\tif ( outgoingInstances.current.has( instance ) ) {\n\t\t\t\toutgoingInstances.current.delete( instance );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontrol.destroy();\n\t\t};\n\t}, [\n\t\tid,\n\t\tidBase,\n\t\tinstance,\n\t\tonChangeInstance,\n\t\tonChangeHasPreview,\n\t\tisMediumLargeViewport,\n\t] );\n\n\tif ( isWide && isMediumLargeViewport ) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={ clsx( {\n\t\t\t\t\t'wp-block-legacy-widget__container': isVisible,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t{ isVisible && (\n\t\t\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\n\t\t\t\t\t\t{ title }\n\t\t\t\t\t</h3>\n\t\t\t\t) }\n\t\t\t\t<Popover\n\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\tplacement=\"right\"\n\t\t\t\t\toffset={ 32 }\n\t\t\t\t\tresize={ false }\n\t\t\t\t\tflip={ false }\n\t\t\t\t\tshift\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\n\t\t\t\t\t\thidden={ ! isVisible }\n\t\t\t\t\t></div>\n\t\t\t\t</Popover>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tref={ ref }\n\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\n\t\t\thidden={ ! isVisible }\n\t\t>\n\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\n\t\t\t\t{ title }\n\t\t\t</h3>\n\t\t</div>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}