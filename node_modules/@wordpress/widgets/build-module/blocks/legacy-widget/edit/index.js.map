{"version":3,"names":["clsx","useBlockProps","BlockControls","InspectorControls","BlockIcon","store","blockEditorStore","Flex","FlexBlock","Spinner","Placeholder","brush","brushIcon","__","useState","useCallback","useSelect","useEntityRecord","WidgetTypeSelector","InspectorCard","Form","Preview","NoPreview","ConvertToBlocksButton","Edit","props","id","idBase","attributes","isWide","blockProps","className","createElement","Empty","NotEmpty","setAttributes","icon","label","selectedId","onSelect","isMulti","instance","clientId","isSelected","hasPreview","setHasPreview","widgetTypeId","record","widgetType","hasResolved","hasResolvedWidgetType","isNavigationMode","select","setInstance","nextInstance","mode","Fragment","group","rawInstance","raw","name","description","title","isVisible","onChangeInstance","onChangeHasPreview"],"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport clsx from 'clsx';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseBlockProps,\n\tBlockControls,\n\tInspectorControls,\n\tBlockIcon,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { Flex, FlexBlock, Spinner, Placeholder } from '@wordpress/components';\nimport { brush as brushIcon } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport { useState, useCallback } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { useEntityRecord } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport WidgetTypeSelector from './widget-type-selector';\nimport InspectorCard from './inspector-card';\nimport Form from './form';\nimport Preview from './preview';\nimport NoPreview from './no-preview';\nimport ConvertToBlocksButton from './convert-to-blocks-button';\n\nexport default function Edit( props ) {\n\tconst { id, idBase } = props.attributes;\n\tconst { isWide = false } = props;\n\n\tconst blockProps = useBlockProps( {\n\t\tclassName: clsx( {\n\t\t\t'is-wide-widget': isWide,\n\t\t} ),\n\t} );\n\n\treturn (\n\t\t<div { ...blockProps }>\n\t\t\t{ ! id && ! idBase ? (\n\t\t\t\t<Empty { ...props } />\n\t\t\t) : (\n\t\t\t\t<NotEmpty { ...props } />\n\t\t\t) }\n\t\t</div>\n\t);\n}\n\nfunction Empty( { attributes: { id, idBase }, setAttributes } ) {\n\treturn (\n\t\t<Placeholder\n\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\n\t\t\tlabel={ __( 'Legacy Widget' ) }\n\t\t>\n\t\t\t<Flex>\n\t\t\t\t<FlexBlock>\n\t\t\t\t\t<WidgetTypeSelector\n\t\t\t\t\t\tselectedId={ id ?? idBase }\n\t\t\t\t\t\tonSelect={ ( { selectedId, isMulti } ) => {\n\t\t\t\t\t\t\tif ( ! selectedId ) {\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} else if ( isMulti ) {\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\t\t\tidBase: selectedId,\n\t\t\t\t\t\t\t\t\tinstance: {},\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: selectedId,\n\t\t\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t</FlexBlock>\n\t\t\t</Flex>\n\t\t</Placeholder>\n\t);\n}\n\nfunction NotEmpty( {\n\tattributes: { id, idBase, instance },\n\tsetAttributes,\n\tclientId,\n\tisSelected,\n\tisWide = false,\n} ) {\n\tconst [ hasPreview, setHasPreview ] = useState( null );\n\n\tconst widgetTypeId = id ?? idBase;\n\tconst { record: widgetType, hasResolved: hasResolvedWidgetType } =\n\t\tuseEntityRecord( 'root', 'widgetType', widgetTypeId );\n\n\tconst isNavigationMode = useSelect(\n\t\t( select ) => select( blockEditorStore ).isNavigationMode(),\n\t\t[]\n\t);\n\n\tconst setInstance = useCallback( ( nextInstance ) => {\n\t\tsetAttributes( { instance: nextInstance } );\n\t}, [] );\n\n\tif ( ! widgetType && hasResolvedWidgetType ) {\n\t\treturn (\n\t\t\t<Placeholder\n\t\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\n\t\t\t\tlabel={ __( 'Legacy Widget' ) }\n\t\t\t>\n\t\t\t\t{ __( 'Widget is missing.' ) }\n\t\t\t</Placeholder>\n\t\t);\n\t}\n\n\tif ( ! hasResolvedWidgetType ) {\n\t\treturn (\n\t\t\t<Placeholder>\n\t\t\t\t<Spinner />\n\t\t\t</Placeholder>\n\t\t);\n\t}\n\n\tconst mode =\n\t\tidBase && ( isNavigationMode || ! isSelected ) ? 'preview' : 'edit';\n\n\treturn (\n\t\t<>\n\t\t\t{ idBase === 'text' && (\n\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t<ConvertToBlocksButton\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trawInstance={ instance.raw }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\n\t\t\t<InspectorControls>\n\t\t\t\t<InspectorCard\n\t\t\t\t\tname={ widgetType.name }\n\t\t\t\t\tdescription={ widgetType.description }\n\t\t\t\t/>\n\t\t\t</InspectorControls>\n\n\t\t\t<Form\n\t\t\t\ttitle={ widgetType.name }\n\t\t\t\tisVisible={ mode === 'edit' }\n\t\t\t\tid={ id }\n\t\t\t\tidBase={ idBase }\n\t\t\t\tinstance={ instance }\n\t\t\t\tisWide={ isWide }\n\t\t\t\tonChangeInstance={ setInstance }\n\t\t\t\tonChangeHasPreview={ setHasPreview }\n\t\t\t/>\n\n\t\t\t{ idBase && (\n\t\t\t\t<>\n\t\t\t\t\t{ hasPreview === null && mode === 'preview' && (\n\t\t\t\t\t\t<Placeholder>\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</Placeholder>\n\t\t\t\t\t) }\n\t\t\t\t\t{ hasPreview === true && (\n\t\t\t\t\t\t<Preview\n\t\t\t\t\t\t\tidBase={ idBase }\n\t\t\t\t\t\t\tinstance={ instance }\n\t\t\t\t\t\t\tisVisible={ mode === 'preview' }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ hasPreview === false && mode === 'preview' && (\n\t\t\t\t\t\t<NoPreview name={ widgetType.name } />\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t) }\n\t\t</>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}