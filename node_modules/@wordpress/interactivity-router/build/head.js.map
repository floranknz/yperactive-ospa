{"version":3,"names":["updateHead","newHead","getTagId","tag","id","outerHTML","newHeadMap","Map","child","set","toRemove","document","head","children","nodeName","push","has","delete","toAppend","values","forEach","n","remove","append","exports","fetchHeadAssets","doc","headElements","headTags","assets","tagName","selector","attribute","asset","tags","querySelectorAll","Promise","all","Array","from","map","attributeValue","getAttribute","response","fetch","text","e","console","error","headElement","get","element","createElement","innerText","attr","attributes","setAttribute","name","value","querySelector"],"sources":["@wordpress/interactivity-router/src/head.js"],"sourcesContent":["/**\n * Helper to update only the necessary tags in the head.\n *\n * @async\n * @param {Array} newHead The head elements of the new page.\n */\nexport const updateHead = async ( newHead ) => {\n\t// Helper to get the tag id store in the cache.\n\tconst getTagId = ( tag ) => tag.id || tag.outerHTML;\n\n\t// Map incoming head tags by their content.\n\tconst newHeadMap = new Map();\n\tfor ( const child of newHead ) {\n\t\tnewHeadMap.set( getTagId( child ), child );\n\t}\n\n\tconst toRemove = [];\n\n\t// Detect nodes that should be added or removed.\n\tfor ( const child of document.head.children ) {\n\t\tconst id = getTagId( child );\n\t\t// Always remove styles and links as they might change.\n\t\tif ( child.nodeName === 'LINK' || child.nodeName === 'STYLE' ) {\n\t\t\ttoRemove.push( child );\n\t\t} else if ( newHeadMap.has( id ) ) {\n\t\t\tnewHeadMap.delete( id );\n\t\t} else if ( child.nodeName !== 'SCRIPT' && child.nodeName !== 'META' ) {\n\t\t\ttoRemove.push( child );\n\t\t}\n\t}\n\n\t// Prepare new assets.\n\tconst toAppend = [ ...newHeadMap.values() ];\n\n\t// Apply the changes.\n\ttoRemove.forEach( ( n ) => n.remove() );\n\tdocument.head.append( ...toAppend );\n};\n\n/**\n * Fetches and processes head assets (stylesheets and scripts) from a specified document.\n *\n * @async\n * @param {Document} doc          The document from which to fetch head assets. It should support standard DOM querying methods.\n * @param {Map}      headElements A map of head elements to modify tracking the URLs of already processed assets to avoid duplicates.\n *\n * @return {Promise<HTMLElement[]>} Returns an array of HTML elements representing the head assets.\n */\nexport const fetchHeadAssets = async ( doc, headElements ) => {\n\tconst headTags = [];\n\tconst assets = [\n\t\t{\n\t\t\ttagName: 'style',\n\t\t\tselector: 'link[rel=stylesheet]',\n\t\t\tattribute: 'href',\n\t\t},\n\t\t{ tagName: 'script', selector: 'script[src]', attribute: 'src' },\n\t];\n\tfor ( const asset of assets ) {\n\t\tconst { tagName, selector, attribute } = asset;\n\t\tconst tags = doc.querySelectorAll( selector );\n\n\t\t// Use Promise.all to wait for fetch to complete\n\t\tawait Promise.all(\n\t\t\tArray.from( tags ).map( async ( tag ) => {\n\t\t\t\tconst attributeValue = tag.getAttribute( attribute );\n\t\t\t\tif ( ! headElements.has( attributeValue ) ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst response = await fetch( attributeValue );\n\t\t\t\t\t\tconst text = await response.text();\n\t\t\t\t\t\theadElements.set( attributeValue, {\n\t\t\t\t\t\t\ttag,\n\t\t\t\t\t\t\ttext,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\tconsole.error( e );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst headElement = headElements.get( attributeValue );\n\t\t\t\tconst element = doc.createElement( tagName );\n\t\t\t\telement.innerText = headElement.text;\n\t\t\t\tfor ( const attr of headElement.tag.attributes ) {\n\t\t\t\t\telement.setAttribute( attr.name, attr.value );\n\t\t\t\t}\n\t\t\t\theadTags.push( element );\n\t\t\t} )\n\t\t);\n\t}\n\n\treturn [\n\t\tdoc.querySelector( 'title' ),\n\t\t...doc.querySelectorAll( 'style' ),\n\t\t...headTags,\n\t];\n};\n"],"mappings":"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","ignoreList":[]}