{"version":3,"names":["_element","require","_blockEditor","_components","_i18n","_constants","_allowOverridesModal","removeBindings","bindings","syncedAttributes","updatedBindings","attributeName","source","PATTERN_OVERRIDES_BINDING_SOURCE","undefined","Object","keys","length","addBindings","PatternOverridesControls","attributes","name","setAttributes","controlId","useId","showAllowOverridesModal","setShowAllowOverridesModal","useState","showDisallowOverridesModal","setShowDisallowOverridesModal","PARTIAL_SYNCING_SUPPORTED_BLOCKS","attributeSources","map","metadata","isConnectedToOtherSources","every","updateBindings","isChecked","customName","prevBindings","updatedMetadata","hasName","allowOverrides","some","_react","createElement","Fragment","InspectorControls","group","BaseControl","id","label","__","help","Button","__next40pxDefaultSize","className","variant","onClick","AllowOverridesModal","initialName","onClose","onSave","newName","DisallowOverridesModal","_default","exports","default"],"sources":["@wordpress/patterns/src/components/pattern-overrides-controls.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, useId } from '@wordpress/element';\nimport { InspectorControls } from '@wordpress/block-editor';\nimport { BaseControl, Button } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport {\n\tPARTIAL_SYNCING_SUPPORTED_BLOCKS,\n\tPATTERN_OVERRIDES_BINDING_SOURCE,\n} from '../constants';\nimport {\n\tAllowOverridesModal,\n\tDisallowOverridesModal,\n} from './allow-overrides-modal';\n\nfunction removeBindings( bindings, syncedAttributes ) {\n\tlet updatedBindings = {};\n\tfor ( const attributeName of syncedAttributes ) {\n\t\t// Omit any bindings that's not the same source from the `updatedBindings` object.\n\t\tif (\n\t\t\tbindings?.[ attributeName ]?.source !==\n\t\t\t\tPATTERN_OVERRIDES_BINDING_SOURCE &&\n\t\t\tbindings?.[ attributeName ]?.source !== undefined\n\t\t) {\n\t\t\tupdatedBindings[ attributeName ] = bindings[ attributeName ];\n\t\t}\n\t}\n\tif ( ! Object.keys( updatedBindings ).length ) {\n\t\tupdatedBindings = undefined;\n\t}\n\treturn updatedBindings;\n}\n\nfunction addBindings( bindings, syncedAttributes ) {\n\tconst updatedBindings = { ...bindings };\n\tfor ( const attributeName of syncedAttributes ) {\n\t\tif ( ! bindings?.[ attributeName ] ) {\n\t\t\tupdatedBindings[ attributeName ] = {\n\t\t\t\tsource: PATTERN_OVERRIDES_BINDING_SOURCE,\n\t\t\t};\n\t\t}\n\t}\n\treturn updatedBindings;\n}\n\nfunction PatternOverridesControls( { attributes, name, setAttributes } ) {\n\tconst controlId = useId();\n\tconst [ showAllowOverridesModal, setShowAllowOverridesModal ] =\n\t\tuseState( false );\n\tconst [ showDisallowOverridesModal, setShowDisallowOverridesModal ] =\n\t\tuseState( false );\n\n\tconst syncedAttributes = PARTIAL_SYNCING_SUPPORTED_BLOCKS[ name ];\n\tconst attributeSources = syncedAttributes.map(\n\t\t( attributeName ) =>\n\t\t\tattributes.metadata?.bindings?.[ attributeName ]?.source\n\t);\n\tconst isConnectedToOtherSources = attributeSources.every(\n\t\t( source ) => source && source !== 'core/pattern-overrides'\n\t);\n\n\tfunction updateBindings( isChecked, customName ) {\n\t\tconst prevBindings = attributes?.metadata?.bindings;\n\t\tconst updatedBindings = isChecked\n\t\t\t? addBindings( prevBindings, syncedAttributes )\n\t\t\t: removeBindings( prevBindings, syncedAttributes );\n\n\t\tconst updatedMetadata = {\n\t\t\t...attributes.metadata,\n\t\t\tbindings: updatedBindings,\n\t\t};\n\n\t\tif ( customName ) {\n\t\t\tupdatedMetadata.name = customName;\n\t\t}\n\n\t\tsetAttributes( {\n\t\t\tmetadata: updatedMetadata,\n\t\t} );\n\t}\n\n\t// Avoid overwriting other (e.g. meta) bindings.\n\tif ( isConnectedToOtherSources ) {\n\t\treturn null;\n\t}\n\n\tconst hasName = !! attributes.metadata?.name;\n\tconst allowOverrides =\n\t\thasName &&\n\t\tattributeSources.some(\n\t\t\t( source ) => source === PATTERN_OVERRIDES_BINDING_SOURCE\n\t\t);\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls group=\"advanced\">\n\t\t\t\t<BaseControl\n\t\t\t\t\tid={ controlId }\n\t\t\t\t\tlabel={ __( 'Overrides' ) }\n\t\t\t\t\thelp={ __(\n\t\t\t\t\t\t'Allow changes to this block throughout instances of this pattern.'\n\t\t\t\t\t) }\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\t\tclassName=\"pattern-overrides-control__allow-overrides-button\"\n\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\taria-haspopup=\"dialog\"\n\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\tif ( allowOverrides ) {\n\t\t\t\t\t\t\t\tsetShowDisallowOverridesModal( true );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetShowAllowOverridesModal( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ allowOverrides\n\t\t\t\t\t\t\t? __( 'Disable overrides' )\n\t\t\t\t\t\t\t: __( 'Enable overrides' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t</BaseControl>\n\t\t\t</InspectorControls>\n\n\t\t\t{ showAllowOverridesModal && (\n\t\t\t\t<AllowOverridesModal\n\t\t\t\t\tinitialName={ attributes.metadata?.name }\n\t\t\t\t\tonClose={ () => setShowAllowOverridesModal( false ) }\n\t\t\t\t\tonSave={ ( newName ) => {\n\t\t\t\t\t\tupdateBindings( true, newName );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ showDisallowOverridesModal && (\n\t\t\t\t<DisallowOverridesModal\n\t\t\t\t\tonClose={ () => setShowDisallowOverridesModal( false ) }\n\t\t\t\t\tonSave={ () => updateBindings( false ) }\n\t\t\t\t/>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nexport default PatternOverridesControls;\n"],"mappings":";;;;;;;AAGA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,YAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,KAAA,GAAAH,OAAA;AAKA,IAAAI,UAAA,GAAAJ,OAAA;AAIA,IAAAK,oBAAA,GAAAL,OAAA;AAfA;AACA;AACA;;AAMA;AACA;AACA;;AAUA,SAASM,cAAcA,CAAEC,QAAQ,EAAEC,gBAAgB,EAAG;EACrD,IAAIC,eAAe,GAAG,CAAC,CAAC;EACxB,KAAM,MAAMC,aAAa,IAAIF,gBAAgB,EAAG;IAC/C;IACA,IACCD,QAAQ,GAAIG,aAAa,CAAE,EAAEC,MAAM,KAClCC,2CAAgC,IACjCL,QAAQ,GAAIG,aAAa,CAAE,EAAEC,MAAM,KAAKE,SAAS,EAChD;MACDJ,eAAe,CAAEC,aAAa,CAAE,GAAGH,QAAQ,CAAEG,aAAa,CAAE;IAC7D;EACD;EACA,IAAK,CAAEI,MAAM,CAACC,IAAI,CAAEN,eAAgB,CAAC,CAACO,MAAM,EAAG;IAC9CP,eAAe,GAAGI,SAAS;EAC5B;EACA,OAAOJ,eAAe;AACvB;AAEA,SAASQ,WAAWA,CAAEV,QAAQ,EAAEC,gBAAgB,EAAG;EAClD,MAAMC,eAAe,GAAG;IAAE,GAAGF;EAAS,CAAC;EACvC,KAAM,MAAMG,aAAa,IAAIF,gBAAgB,EAAG;IAC/C,IAAK,CAAED,QAAQ,GAAIG,aAAa,CAAE,EAAG;MACpCD,eAAe,CAAEC,aAAa,CAAE,GAAG;QAClCC,MAAM,EAAEC;MACT,CAAC;IACF;EACD;EACA,OAAOH,eAAe;AACvB;AAEA,SAASS,wBAAwBA,CAAE;EAAEC,UAAU;EAAEC,IAAI;EAAEC;AAAc,CAAC,EAAG;EACxE,MAAMC,SAAS,GAAG,IAAAC,cAAK,EAAC,CAAC;EACzB,MAAM,CAAEC,uBAAuB,EAAEC,0BAA0B,CAAE,GAC5D,IAAAC,iBAAQ,EAAE,KAAM,CAAC;EAClB,MAAM,CAAEC,0BAA0B,EAAEC,6BAA6B,CAAE,GAClE,IAAAF,iBAAQ,EAAE,KAAM,CAAC;EAElB,MAAMlB,gBAAgB,GAAGqB,2CAAgC,CAAET,IAAI,CAAE;EACjE,MAAMU,gBAAgB,GAAGtB,gBAAgB,CAACuB,GAAG,CAC1CrB,aAAa,IACdS,UAAU,CAACa,QAAQ,EAAEzB,QAAQ,GAAIG,aAAa,CAAE,EAAEC,MACpD,CAAC;EACD,MAAMsB,yBAAyB,GAAGH,gBAAgB,CAACI,KAAK,CACrDvB,MAAM,IAAMA,MAAM,IAAIA,MAAM,KAAK,wBACpC,CAAC;EAED,SAASwB,cAAcA,CAAEC,SAAS,EAAEC,UAAU,EAAG;IAChD,MAAMC,YAAY,GAAGnB,UAAU,EAAEa,QAAQ,EAAEzB,QAAQ;IACnD,MAAME,eAAe,GAAG2B,SAAS,GAC9BnB,WAAW,CAAEqB,YAAY,EAAE9B,gBAAiB,CAAC,GAC7CF,cAAc,CAAEgC,YAAY,EAAE9B,gBAAiB,CAAC;IAEnD,MAAM+B,eAAe,GAAG;MACvB,GAAGpB,UAAU,CAACa,QAAQ;MACtBzB,QAAQ,EAAEE;IACX,CAAC;IAED,IAAK4B,UAAU,EAAG;MACjBE,eAAe,CAACnB,IAAI,GAAGiB,UAAU;IAClC;IAEAhB,aAAa,CAAE;MACdW,QAAQ,EAAEO;IACX,CAAE,CAAC;EACJ;;EAEA;EACA,IAAKN,yBAAyB,EAAG;IAChC,OAAO,IAAI;EACZ;EAEA,MAAMO,OAAO,GAAG,CAAC,CAAErB,UAAU,CAACa,QAAQ,EAAEZ,IAAI;EAC5C,MAAMqB,cAAc,GACnBD,OAAO,IACPV,gBAAgB,CAACY,IAAI,CAClB/B,MAAM,IAAMA,MAAM,KAAKC,2CAC1B,CAAC;EAEF,OACC,IAAA+B,MAAA,CAAAC,aAAA,EAAAD,MAAA,CAAAE,QAAA,QACC,IAAAF,MAAA,CAAAC,aAAA,EAAC3C,YAAA,CAAA6C,iBAAiB;IAACC,KAAK,EAAC;EAAU,GAClC,IAAAJ,MAAA,CAAAC,aAAA,EAAC1C,WAAA,CAAA8C,WAAW;IACXC,EAAE,EAAG3B,SAAW;IAChB4B,KAAK,EAAG,IAAAC,QAAE,EAAE,WAAY,CAAG;IAC3BC,IAAI,EAAG,IAAAD,QAAE,EACR,mEACD;EAAG,GAEH,IAAAR,MAAA,CAAAC,aAAA,EAAC1C,WAAA,CAAAmD,MAAM;IACNC,qBAAqB;IACrBC,SAAS,EAAC,mDAAmD;IAC7DC,OAAO,EAAC,WAAW;IACnB,iBAAc,QAAQ;IACtBC,OAAO,EAAGA,CAAA,KAAM;MACf,IAAKhB,cAAc,EAAG;QACrBb,6BAA6B,CAAE,IAAK,CAAC;MACtC,CAAC,MAAM;QACNH,0BAA0B,CAAE,IAAK,CAAC;MACnC;IACD;EAAG,GAEDgB,cAAc,GACb,IAAAU,QAAE,EAAE,mBAAoB,CAAC,GACzB,IAAAA,QAAE,EAAE,kBAAmB,CACnB,CACI,CACK,CAAC,EAElB3B,uBAAuB,IACxB,IAAAmB,MAAA,CAAAC,aAAA,EAACvC,oBAAA,CAAAqD,mBAAmB;IACnBC,WAAW,EAAGxC,UAAU,CAACa,QAAQ,EAAEZ,IAAM;IACzCwC,OAAO,EAAGA,CAAA,KAAMnC,0BAA0B,CAAE,KAAM,CAAG;IACrDoC,MAAM,EAAKC,OAAO,IAAM;MACvB3B,cAAc,CAAE,IAAI,EAAE2B,OAAQ,CAAC;IAChC;EAAG,CACH,CACD,EACCnC,0BAA0B,IAC3B,IAAAgB,MAAA,CAAAC,aAAA,EAACvC,oBAAA,CAAA0D,sBAAsB;IACtBH,OAAO,EAAGA,CAAA,KAAMhC,6BAA6B,CAAE,KAAM,CAAG;IACxDiC,MAAM,EAAGA,CAAA,KAAM1B,cAAc,CAAE,KAAM;EAAG,CACxC,CAED,CAAC;AAEL;AAAC,IAAA6B,QAAA,GAAAC,OAAA,CAAAC,OAAA,GAEchD,wBAAwB","ignoreList":[]}