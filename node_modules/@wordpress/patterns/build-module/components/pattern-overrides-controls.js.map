{"version":3,"names":["useState","useId","InspectorControls","BaseControl","Button","__","PARTIAL_SYNCING_SUPPORTED_BLOCKS","PATTERN_OVERRIDES_BINDING_SOURCE","AllowOverridesModal","DisallowOverridesModal","removeBindings","bindings","syncedAttributes","updatedBindings","attributeName","source","undefined","Object","keys","length","addBindings","PatternOverridesControls","attributes","name","setAttributes","controlId","showAllowOverridesModal","setShowAllowOverridesModal","showDisallowOverridesModal","setShowDisallowOverridesModal","attributeSources","map","metadata","isConnectedToOtherSources","every","updateBindings","isChecked","customName","prevBindings","updatedMetadata","hasName","allowOverrides","some","createElement","Fragment","group","id","label","help","__next40pxDefaultSize","className","variant","onClick","initialName","onClose","onSave","newName"],"sources":["@wordpress/patterns/src/components/pattern-overrides-controls.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, useId } from '@wordpress/element';\nimport { InspectorControls } from '@wordpress/block-editor';\nimport { BaseControl, Button } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport {\n\tPARTIAL_SYNCING_SUPPORTED_BLOCKS,\n\tPATTERN_OVERRIDES_BINDING_SOURCE,\n} from '../constants';\nimport {\n\tAllowOverridesModal,\n\tDisallowOverridesModal,\n} from './allow-overrides-modal';\n\nfunction removeBindings( bindings, syncedAttributes ) {\n\tlet updatedBindings = {};\n\tfor ( const attributeName of syncedAttributes ) {\n\t\t// Omit any bindings that's not the same source from the `updatedBindings` object.\n\t\tif (\n\t\t\tbindings?.[ attributeName ]?.source !==\n\t\t\t\tPATTERN_OVERRIDES_BINDING_SOURCE &&\n\t\t\tbindings?.[ attributeName ]?.source !== undefined\n\t\t) {\n\t\t\tupdatedBindings[ attributeName ] = bindings[ attributeName ];\n\t\t}\n\t}\n\tif ( ! Object.keys( updatedBindings ).length ) {\n\t\tupdatedBindings = undefined;\n\t}\n\treturn updatedBindings;\n}\n\nfunction addBindings( bindings, syncedAttributes ) {\n\tconst updatedBindings = { ...bindings };\n\tfor ( const attributeName of syncedAttributes ) {\n\t\tif ( ! bindings?.[ attributeName ] ) {\n\t\t\tupdatedBindings[ attributeName ] = {\n\t\t\t\tsource: PATTERN_OVERRIDES_BINDING_SOURCE,\n\t\t\t};\n\t\t}\n\t}\n\treturn updatedBindings;\n}\n\nfunction PatternOverridesControls( { attributes, name, setAttributes } ) {\n\tconst controlId = useId();\n\tconst [ showAllowOverridesModal, setShowAllowOverridesModal ] =\n\t\tuseState( false );\n\tconst [ showDisallowOverridesModal, setShowDisallowOverridesModal ] =\n\t\tuseState( false );\n\n\tconst syncedAttributes = PARTIAL_SYNCING_SUPPORTED_BLOCKS[ name ];\n\tconst attributeSources = syncedAttributes.map(\n\t\t( attributeName ) =>\n\t\t\tattributes.metadata?.bindings?.[ attributeName ]?.source\n\t);\n\tconst isConnectedToOtherSources = attributeSources.every(\n\t\t( source ) => source && source !== 'core/pattern-overrides'\n\t);\n\n\tfunction updateBindings( isChecked, customName ) {\n\t\tconst prevBindings = attributes?.metadata?.bindings;\n\t\tconst updatedBindings = isChecked\n\t\t\t? addBindings( prevBindings, syncedAttributes )\n\t\t\t: removeBindings( prevBindings, syncedAttributes );\n\n\t\tconst updatedMetadata = {\n\t\t\t...attributes.metadata,\n\t\t\tbindings: updatedBindings,\n\t\t};\n\n\t\tif ( customName ) {\n\t\t\tupdatedMetadata.name = customName;\n\t\t}\n\n\t\tsetAttributes( {\n\t\t\tmetadata: updatedMetadata,\n\t\t} );\n\t}\n\n\t// Avoid overwriting other (e.g. meta) bindings.\n\tif ( isConnectedToOtherSources ) {\n\t\treturn null;\n\t}\n\n\tconst hasName = !! attributes.metadata?.name;\n\tconst allowOverrides =\n\t\thasName &&\n\t\tattributeSources.some(\n\t\t\t( source ) => source === PATTERN_OVERRIDES_BINDING_SOURCE\n\t\t);\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls group=\"advanced\">\n\t\t\t\t<BaseControl\n\t\t\t\t\tid={ controlId }\n\t\t\t\t\tlabel={ __( 'Overrides' ) }\n\t\t\t\t\thelp={ __(\n\t\t\t\t\t\t'Allow changes to this block throughout instances of this pattern.'\n\t\t\t\t\t) }\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\t\tclassName=\"pattern-overrides-control__allow-overrides-button\"\n\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\taria-haspopup=\"dialog\"\n\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\tif ( allowOverrides ) {\n\t\t\t\t\t\t\t\tsetShowDisallowOverridesModal( true );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetShowAllowOverridesModal( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ allowOverrides\n\t\t\t\t\t\t\t? __( 'Disable overrides' )\n\t\t\t\t\t\t\t: __( 'Enable overrides' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t</BaseControl>\n\t\t\t</InspectorControls>\n\n\t\t\t{ showAllowOverridesModal && (\n\t\t\t\t<AllowOverridesModal\n\t\t\t\t\tinitialName={ attributes.metadata?.name }\n\t\t\t\t\tonClose={ () => setShowAllowOverridesModal( false ) }\n\t\t\t\t\tonSave={ ( newName ) => {\n\t\t\t\t\t\tupdateBindings( true, newName );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ showDisallowOverridesModal && (\n\t\t\t\t<DisallowOverridesModal\n\t\t\t\t\tonClose={ () => setShowDisallowOverridesModal( false ) }\n\t\t\t\t\tonSave={ () => updateBindings( false ) }\n\t\t\t\t/>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nexport default PatternOverridesControls;\n"],"mappings":"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","ignoreList":[]}